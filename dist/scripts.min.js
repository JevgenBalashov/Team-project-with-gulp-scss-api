let cardElem;class App{constructor(){this.loginButton=document.getElementById("login__button"),this.loginForm=document.querySelector(".login__form"),this.createVisitButton=document.querySelector(".header_btn.second__btn"),this.closeIcon=document.querySelector(".close-icon"),this.logOutButton=document.getElementById("logout__button"),this.visitWindow=document.querySelector(".visit__window"),this.closeVisitWindow=document.querySelector(".icon-close"),this.emailInput=document.getElementById("email"),this.passwordInput=document.getElementById("password"),this.registerForm=document.querySelector(".register__form"),this.registerEmailInput=document.getElementById("register-email"),this.registerPasswordInput=document.getElementById("register-password"),this.initialize()}initialize(){this.addEventListeners(),this.checkAuthentication()}addEventListeners(){this.visitWindow.addEventListener("click",e=>{e.target!==document.querySelector(".visit__window")&&!e.target.classList.contains("fa-xmark")||(this.visitWindow.style.display="none",document.body.style.overflow="")}),this.createVisitButton.addEventListener("click",()=>{window.scrollTo(0,0),this.visitWindow.style.display="block",document.body.style.overflow="hidden"}),this.loginButton.addEventListener("click",()=>{window.scrollTo(0,0),this.loginForm.style.display="block",document.body.style.overflow="hidden"}),this.loginForm.addEventListener("submit",e=>{document.body.style.overflow="",e.preventDefault(),this.handleLoginFormSubmit()}),this.logOutButton.addEventListener("click",()=>{this.logout()}),this.loginForm.addEventListener("click",e=>{e.target!==document.querySelector("div.form__baground")&&!e.target.classList.contains("fa-xmark")||(this.loginForm.style.display="none",document.body.style.overflow="")}),this.registerForm&&this.registerForm.addEventListener("submit",e=>{document.body.style.overflow="",e.preventDefault(),this.handleRegisterFormSubmit()})}checkAuthentication(){this.isAuthenticated()?this.showLoggedInState():this.showLoggedOutState()}handleLoginFormSubmit(){var e=this.emailInput.value,t=this.passwordInput.value;this.login(e,t).then(e=>{e&&(console.log("Користувач успішно авторизований!"),this.loginForm.style.display="none",this.showLoggedInState())}).catch(e=>{console.log("Помилка при авторизації: "+e.message)})}handleRegisterFormSubmit(){var e=this.registerEmailInput.value,t=this.registerPasswordInput.value;this.register(e,t).then(e=>{e&&console.log("Користувач успішно зареєстрований!")}).catch(e=>{console.log("Помилка при реєстрації: "+e.message)})}login(e,t){return fetch("https://ajax.test-danit.com/api/v2/cards/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then(e=>{if(e.ok)return e.text();throw e="Помилка при отриманні токена: "+e.status,new Error(e)}).then(e=>(this.saveToken(e),!0)).catch(e=>{throw new Error("Помилка при виконанні запиту: "+e)})}register(e,t){return fetch("https://ajax.test-danit.com/api/v2/cards",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then(e=>e.ok?e.text():e.text().then(e=>{throw new Error(e)})).then(e=>(this.saveToken(e),!0)).catch(e=>{throw new Error("Помилка при виконанні запиту: "+e)})}logout(){this.removeToken(),console.log("Користувач вийшов з аккаунту"),this.showLoggedOutState()}saveToken(e){localStorage.setItem("token",e)}getToken(){return localStorage.getItem("token")}removeToken(){localStorage.removeItem("token")}isAuthenticated(){var e=this.getToken();return null!=e}showLoggedInState(){this.loginButton.style.display="none",this.createVisitButton.style.display="inline-block",this.logOutButton.style.display="block"}showLoggedOutState(){this.loginButton.style.display="block",this.createVisitButton.style.display="none",this.logOutButton.style.display="none"}}const app=new App;class Modal{constructor(){this.editingCard=!1,this.editBtn=document.querySelector(".visit__edit-btn"),this.cardiologistFields={typicalPressure:document.querySelector(".visit__info-typical-pressure"),bodyMassIndex:document.querySelector(".visit__info-body-mass-index"),heartDiseases:document.querySelector(".visit__info-heart-diseases"),ageCardiologist:document.querySelector(".visit__info-age-cardiologist")},this.dentistFields={lastVisitDate:document.querySelector(".visit__info-last-visit-date")},this.therapistFields={ageTherapist:document.querySelector(".visit__info-age-therapist")},this.hideCardiologistFields=()=>{Object.values(this.cardiologistFields).forEach(e=>{e.style.display="none"})},this.hideDentistFields=()=>{Object.values(this.dentistFields).forEach(e=>{e.style.display="none"})},this.hideTherapistFields=()=>{Object.values(this.therapistFields).forEach(e=>{e.style.display="none"})},document.querySelector(".visit__info-doctor").addEventListener("change",e=>{console.log(e);e=document.querySelector(".visit__info-doctor").value;this.hideCardiologistFields(),this.hideDentistFields(),this.hideTherapistFields(),"cardiologist"===e?Object.values(this.cardiologistFields).forEach(e=>{e.style.display="block"}):"dentist"===e?Object.values(this.dentistFields).forEach(e=>{e.style.display="block"}):"therapist"===e&&Object.values(this.therapistFields).forEach(e=>{e.style.display="block"})}),document.querySelector(".visit__create-btn").addEventListener("click",e=>{var t,i,s,o,n;e.preventDefault(),document.querySelector(".visit__window").style.display="none",document.body.style.overflow="",this.editingCard||(e=document.querySelector(".visit__info-fullname").value,t=document.querySelector(".visit__info-doctor").value,i=document.querySelector(".visit__info-purpose").value,s=document.querySelector(".visit__info-description").value,o=document.querySelector(".visit__info-urgency").value,n={},"cardiologist"===t?(n.bp=this.cardiologistFields.typicalPressure.value,n.bodyMassIndex=this.cardiologistFields.bodyMassIndex.value,n.heartDiseases=this.cardiologistFields.heartDiseases.value,n.age=this.cardiologistFields.ageCardiologist.value):"dentist"===t?n.lastVisitDate=this.dentistFields.lastVisitDate.value:"therapist"===t&&(n.age=this.therapistFields.ageTherapist.value),e={clientName:e,doctor:t,description:i+" - "+s,urgency:o,...n},fetch("https://ajax.test-danit.com/api/v2/cards",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{document.querySelector(".visit__cards-notification").style.display="none",this.showCard(e),this.setupDeleteEventListener(cardElem,e.id,e),console.log(e)}).catch(e=>{console.error("Помилка при виконанні запиту:",e)}))})}setupDeleteEventListener(l,d,r){l.addEventListener("click",e=>{var t,i,s,o,n,a;console.log(e.target),e.target.classList.contains("fa-trash")?(l.style.display="none",console.log(d),fetch("https://ajax.test-danit.com/api/v2/cards/"+d,{method:"DELETE",headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>{console.log(`Картка з id '${d}' була успішно видалена`)}).catch(e=>{console.error("Помилка при видаленні карти:",e)})):e.target.classList.contains("fa-note-sticky")?(window.scrollTo(0,0),this.editingCard=!0,document.querySelector(".visit__window").style.display="block",document.querySelector("button.visit__create-btn").style.display="none",this.editBtn.style.display="block",document.body.style.overflow="hidden",document.querySelector("span.visit__form-title").textContent="EDIT VISIT INFORMATION:",this.editBtn.addEventListener("click",e=>{e.preventDefault(),document.querySelector(".visit__window").style.display="none",document.body.style.overflow="",console.log("Editing card info...");var e=document.querySelector(".visit__info-fullname").value,t=document.querySelector(".visit__info-doctor").value,i=document.querySelector(".visit__info-purpose").value,s=document.querySelector(".visit__info-description").value,o=document.querySelector(".visit__info-urgency").value,n={},n=("cardiologist"===t?(n.bp=this.cardiologistFields.typicalPressure.value,n.bodyMassIndex=this.cardiologistFields.bodyMassIndex.value,n.heartDiseases=this.cardiologistFields.heartDiseases.value,n.age=this.cardiologistFields.ageCardiologist.value):"dentist"===t?n.lastVisitDate=this.dentistFields.lastVisitDate.value:"therapist"===t&&(n.age=this.therapistFields.ageTherapist.value),{clientName:e,doctor:t,description:i+" - "+s,urgency:o,...n});console.log(e,t,i,s,o),fetch("https://ajax.test-danit.com/api/v2/cards/"+d,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(n)}).then(e=>e.json()).then(e=>{l.style.display="none",console.log(e),this.showCard(e),this.setupDeleteEventListener(cardElem,e.id,e)})})):e.target.classList.contains("fa-circle-info")&&(e.target.style.display="none",e=document.createElement("h3"),t=document.createElement("h3"),i=document.createElement("h3"),s=document.createElement("h3"),o=document.createElement("h3"),n=document.createElement("h3"),a=document.createElement("h3"),r.description&&(e.style.paddingTop="10px",e.textContent=r.description,e.classList.add("card__doc-profile")),r.bp&&(t.style.paddingTop="10px",t.textContent="Typical pressure: "+r.bp,t.classList.add("card__doc-profile")),r.age&&(i.style.paddingTop="10px",i.textContent="Age of client: "+r.age,i.classList.add("card__doc-profile")),r.lastVisitDate&&(s.style.paddingTop="10px",s.textContent="Last visit: "+r.lastVisitDate,s.classList.add("card__doc-profile")),r.bodyMassIndex&&(o.style.paddingTop="10px",o.textContent="Body mass index: "+r.bodyMassIndex,o.classList.add("card__doc-profile")),r.heartDiseases&&(n.style.paddingTop="10px",n.textContent="Body mass index: "+r.heartDiseases,n.classList.add("card__doc-profile")),r.urgency&&(a.style.paddingTop="10px",a.textContent="Urgency of the visit: "+r.urgency,a.classList.add("card__doc-profile")),l.append(e),l.append(t),l.append(i),l.append(s),l.append(o),l.append(n),l.append(a))})}showCard(e){this.editingCard=!1;var t=document.getElementById("root"),i=document.createElement("div"),s=(i.classList.add("card"),document.createElement("h1")),s=(s.classList.add("card__title"),s.textContent=e.clientName,i.append(s),document.createElement("h3")),e=(s.classList.add("card__doc-profile"),s.textContent=e.doctor,i.append(s),document.createElement("div"));e.classList.add("card__btn"),e.innerHTML=`<button class="card__btn-optional card__btn-more-info"><i class="fa-solid fa-circle-info"></i></button>
    <button class="card__btn-optional card__btn-edit-info"><i class="fa-solid fa-note-sticky"></i></button>
    <button class="card__btn-optional card__btn-delete"><i class="fa-solid fa-trash"></i></button>`,i.append(e),t.append(i),cardElem=i}}const modal=new Modal;function getAllCards(){return fetch("https://ajax.test-danit.com/api/v2/cards",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>console.log(e))}localStorage.getItem("token")&&getAllCards();