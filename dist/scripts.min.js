class App{constructor(){this.loginButton=document.getElementById("login__button"),this.loginForm=document.querySelector(".login__form"),this.createVisitButton=document.querySelector(".header_btn.second__btn"),this.closeIcon=document.querySelector(".close-icon"),this.logOutButton=document.getElementById("logout__button"),this.visitWindow=document.querySelector(".visit__window"),this.closeVisitWindow=document.querySelector(".icon-close"),this.emailInput=document.getElementById("email"),this.passwordInput=document.getElementById("password"),this.registerForm=document.querySelector(".register__form"),this.registerEmailInput=document.getElementById("register-email"),this.registerPasswordInput=document.getElementById("register-password"),this.initialize()}initialize(){this.addEventListeners(),this.checkAuthentication()}addEventListeners(){this.closeVisitWindow.addEventListener("click",()=>{this.visitWindow.style.display="none"}),this.createVisitButton.addEventListener("click",()=>{this.visitWindow.style.display="block"}),this.loginButton.addEventListener("click",()=>{this.loginForm.style.display="block"}),this.loginForm.addEventListener("submit",t=>{t.preventDefault(),this.handleLoginFormSubmit()}),this.logOutButton.addEventListener("click",()=>{this.logout()}),this.closeIcon.addEventListener("click",()=>{this.loginForm.style.display="none"}),this.registerForm&&this.registerForm.addEventListener("submit",t=>{t.preventDefault(),this.handleRegisterFormSubmit()})}checkAuthentication(){this.isAuthenticated()?this.showLoggedInState():this.showLoggedOutState()}handleLoginFormSubmit(){var t=this.emailInput.value,e=this.passwordInput.value;this.login(t,e).then(t=>{t&&(console.log("Користувач успішно авторизований!"),this.loginForm.style.display="none",this.showLoggedInState())}).catch(t=>{console.log("Помилка при авторизації: "+t.message)})}handleRegisterFormSubmit(){var t=this.registerEmailInput.value,e=this.registerPasswordInput.value;this.register(t,e).then(t=>{t&&console.log("Користувач успішно зареєстрований!")}).catch(t=>{console.log("Помилка при реєстрації: "+t.message)})}login(t,e){return fetch("https://ajax.test-danit.com/api/v2/cards/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:e})}).then(t=>{if(t.ok)return t.text();throw t="Помилка при отриманні токена: "+t.status,new Error(t)}).then(t=>(this.saveToken(t),!0)).catch(t=>{throw new Error("Помилка при виконанні запиту: "+t)})}register(t,e){return fetch("https://ajax.test-danit.com/api/v2/cards",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:e})}).then(t=>t.ok?t.text():t.text().then(t=>{throw new Error(t)})).then(t=>(this.saveToken(t),!0)).catch(t=>{throw new Error("Помилка при виконанні запиту: "+t)})}logout(){this.removeToken(),console.log("Користувач вийшов з аккаунту"),this.showLoggedOutState()}saveToken(t){localStorage.setItem("token",t)}getToken(){return localStorage.getItem("token")}removeToken(){localStorage.removeItem("token")}isAuthenticated(){var t=this.getToken();return null!=t}showLoggedInState(){this.loginButton.style.display="none",this.createVisitButton.style.display="inline-block",this.logOutButton.style.display="block"}showLoggedOutState(){this.loginButton.style.display="block",this.createVisitButton.style.display="none",this.logOutButton.style.display="none"}}const app=new App;class Modal{constructor(){this.cardiologistFields={typicalPressure:document.querySelector(".visit__info-typical-pressure"),bodyMassIndex:document.querySelector(".visit__info-body-mass-index"),heartDiseases:document.querySelector(".visit__info-heart-diseases"),ageCardiologist:document.querySelector(".visit__info-age-cardiologist")},this.dentistFields={lastVisitDate:document.querySelector(".visit__info-last-visit-date")},this.therapistFields={ageTherapist:document.querySelector(".visit__info-age-therapist")},this.hideCardiologistFields=()=>{Object.values(this.cardiologistFields).forEach(t=>{t.style.display="none"})},this.hideDentistFields=()=>{Object.values(this.dentistFields).forEach(t=>{t.style.display="none"})},this.hideTherapistFields=()=>{Object.values(this.therapistFields).forEach(t=>{t.style.display="none"})},this.hideCardiologistFields(),this.hideDentistFields(),this.hideTherapistFields(),document.querySelector(".visit__info-doctor").addEventListener("change",()=>{var t=document.querySelector(".visit__info-doctor").value;this.hideCardiologistFields(),this.hideDentistFields(),this.hideTherapistFields(),"cardiologist"===t?Object.values(this.cardiologistFields).forEach(t=>{t.style.display="block"}):"dentist"===t?Object.values(this.dentistFields).forEach(t=>{t.style.display="block"}):"therapist"===t&&Object.values(this.therapistFields).forEach(t=>{t.style.display="block"})}),document.querySelector(".visit__info-form").addEventListener("submit",t=>{t.preventDefault();var t=document.querySelector(".visit__info-fullname").value,e=document.querySelector(".visit__info-doctor").value,i=document.querySelector(".visit__info-purpose").value,s=document.querySelector(".visit__info-description").value,o=(document.querySelector(".visit__info-urgency").value,{}),t=("cardiologist"===e?(o.bp=this.cardiologistFields.typicalPressure.value,o.age=this.cardiologistFields.ageCardiologist.value):"dentist"===e?o.lastVisitDate=this.dentistFields.lastVisitDate.value:"therapist"===e&&(o.age=this.therapistFields.ageTherapist.value),{title:t+" - "+e,description:i+" - "+s,doctor:e,...o});fetch("https://ajax.test-danit.com/api/v2/cards",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ad62d8cc-c743-41e0-918c-cc6bfc73a2fe"},body:JSON.stringify(t)}).then(t=>t.json()).then(t=>{console.log(t)}).catch(t=>{console.error("Помилка при виконанні запиту:",t)})})}}const modal=new Modal;